{% extends 'base.html' %}

{% block title %}Projects{% endblock %}

{% block content %}
    {% load static %}
    <div class="w-full h-full flex-col">
    <div class="project-search p2 form-field" style="position: relative; display: flex; gap: 1em">
        <input type="text" autocomplete="off" class="font-helv"
               style="color: black; font-size: 20px; border: 0.1em solid gray" id="search-input"
               placeholder="Search projects">
        <div class="display-view-change">
            <div id="last-update">Ostatnia aktualizacja: teraz</div>
            <img src="{% static 'icons/details.svg' %}">
        </div>
    </div>

    <div class="skelet_projects_list">
        <ul class="skelet_projects" id="projects-list">
            {% for project in projects %}
                <li class="skelet_project"
                    data-name="{{ project.name }}"
                    data-description="{{ project.description }}"
                    data-owner="{{ project.owner }}"
                    data-team="{{ project.team }}"
                    data-created="{{ project.created_at }}"
                    data-updated="{{ project.updated_at }}">
                    <a href="{% url 'project_detail' project.pk %}">
                        <p>{{ project.name }}</p>
                        <p>{{ project.description }}</p>
                    </a>
                </li>
            {% empty %}
                <li>No projects found.</li>
            {% endfor %}
            <li class="skelet_project active-details">
                <a href="{% url 'project_create' %}">Add New Project</a>
            </li>
        </ul>
    </div>
    <div class="skelet_projects_list_detailed">
        <ul class="skelet_projects_detailed">
            <div class="skelet_projects_list_detailed_devider">
                <div class="skelet_projects_list_detailed_devider_icon">
                    <img src="{% static 'icons/expand_arrow.svg' %}" style="width: 1em; height: 1em">
                </div>
                <span class="skelet_projects_list_detailed_devider_label">All Projects</span>
            </div>
            {% for project in projects %}
                <li class="skelet_project_detailed"
                    data-name="{{ project.name }}"
                    data-description="{{ project.description }}"
                    data-owner="{{ project.owner }}"
                    data-team="{{ project.team }}"
                    data-status="{{ project.status }}"
                    data-created="{{ project.created_at }}"
                    data-updated="{{ project.updated_at }}">
                    <div class="skelet_project_detailed_icon">
                        <div class="skelet_project_detailed_icon_square"></div>
                    </div>
                    <a href="{% url 'project_detail' project.pk %}" class="data-fields">
                        <div class="data-field project-name"><span>{{ project.name }}</span></div>
                        <div class="data-field project-description"><span>{{ project.description }}</span></div>
                        <div class="data-field project-created_at"><span>{{ project.created_at }}</span></div>
                        <div class="data-field project-updated_at"><span>{{ project.updated_at }}</span></div>
                        <div class="data-field project-status"><span>{{ project.status }}</span></div>
                        <div class="data-field project-owner"><span>{{ project.owner }}</span></div>
                        <div class="data-field project-team"><span>
                         {% for member in project.team.all %}
                             <div class="project-single-member">
                             {% if member.profile_picture == "" %}
                                 <div class="field-avatar"></div>
                             {% else %}
                                 <div class="field-avatar">

                                    <img src="/dashboard{{ member.profile_picture.url }}" alt="">
                                    <div class="infobar">
                                        
                                    <div class="field-avatar" field-user-id="{{ member.id }}" style="background: {% if member.status == "online" %}green{% else %}red{% endif %};">
                                         </div>
                                         <div class="field-avatar">
                                            <img src="/dashboard{{ member.profile_picture.url }}" alt="">
                                         </div>
                                         <span>{{ member.first_name }}</span>
                                         <span>{{ member.last_name }}</span>
                                     </div>
                                 </div>
                             {% endif %}
                             </div>
                         {% empty %}
                             -
                         {% endfor %}
                        </span></div>
                        {#                        <p class="project-dates">#}
                        {#                            Created: {{ project.created_at }} | Updated: {{ project.updated_at }}#}
                        {#                        </p>#}
                    </a>
                </li>
            {% empty %}
                <li>No projects found.</li>
            {% endfor %}
        </ul>
        <div class="add-project">
            <li class="skelet_project_detailed">
                <a href="{% url 'project_create' %}" style="text-decoration: none; color: gray">Add New Project</a>
            </li>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('search-input');
            const projectsList = document.getElementById('projects-list');
            const projects = projectsList.getElementsByClassName('skelet_project');

            searchInput.addEventListener('keyup', function () {
                const filter = searchInput.value.toLowerCase();

                Array.from(projects).forEach(function (project) {
                    const name = project.getAttribute('data-name').toLowerCase();
                    const description = project.getAttribute('data-description').toLowerCase();
                    const owner = project.getAttribute('data-owner').toLowerCase();
                    const team = project.getAttribute('data-team').toLowerCase();
                    const created = project.getAttribute('data-created').toLowerCase();
                    const updated = project.getAttribute('data-updated').toLowerCase();

                    if (name.includes(filter) || description.includes(filter) ||
                        owner.includes(filter) || team.includes(filter) ||
                        created.includes(filter) || updated.includes(filter)) {
                        project.style.display = '';
                    } else {
                        project.style.display = 'none';
                    }
                });
            });
        });
    </script>
    <script>
        let view_simple = document.querySelector(".skelet_projects_list");
        let view_detailed = document.querySelector(".skelet_projects_list_detailed");

        view_detailed.classList.toggle("active-simple")

        document.querySelector(".display-view-change").addEventListener("click", (e) => {
            view_simple.classList.toggle("active-simple");
            view_detailed.classList.toggle("active-details");
        })
    </script>
    <script>
        document.querySelectorAll('.field-avatar').forEach(value => {
            value.addEventListener('mouseenter', (event) => {
                event.target.querySelector(".infobar").classList.toggle('showInfoBar')
            })
            value.addEventListener('mouseleave', (event) => {
                event.target.querySelector(".infobar").classList.toggle('showInfoBar')
            })
        })
    </script>
{% endblock %}
